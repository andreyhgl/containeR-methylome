Bootstrap: docker
From: bioconductor/bioconductor_docker:devel

%labels
  Author https://github.com/andreyhgl

%environment
  export LC_ALL=C

%post
  apt-get update
  
  # Install less
  apt-get install -y less

  # qpdf (for parallisation of producing PDFs in R, plotting)
  apt-get install -y qpdf
  
  # install Quarto 1.8.27
  wget https://github.com/quarto-dev/quarto-cli/releases/download/v1.8.27/quarto-1.8.27-linux-amd64.deb
  apt-get install -y ./quarto-1.8.27-linux-amd64.deb

  # Clean up apt cache to reduce image size
  rm quarto-1.8.27-linux-amd64.deb

  # Clean up apt cache to reduce image size
  apt-get clean
  rm -rf /var/lib/apt/lists/*

# ~~ install R libraries ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ #

# from CRAN
cat << EOF > pkgs-CRAN.txt
tidyverse
gt
DT
gtools
tools
scales
data.table
ggrepel
ggvenn
RColorBrewer
cowplot
ggsignif
openxlsx
patchwork
EOF

R -e "install.packages(readLines('pkgs-CRAN.txt'))"

# from Bioconductor
cat << EOF > pkgs-Bioc.txt
clusterProfiler
ReactomePA
methylKit
tximport
biomaRt
ComplexHeatmap
genomation
org.Mm.eg.db
org.Hs.eg.db
EOF

R -e "BiocManager::install(readLines('pkgs-Bioc.txt'))"

%runscript
  Rscript "$@"